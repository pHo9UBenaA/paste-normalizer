以下の拡張機能を作成して

# Paste Normalizer

### Goal

Create a VSCode extension command that normalizes pasted AI-generated text (e.g., Claude Code output) in the active editor.

The command should:

* Remove unnecessary indentation introduced by copy-paste
* Normalize paragraph line wrapping
* Preserve ASCII box-drawing tables
* Preserve fenced code blocks
* Remove trailing whitespace
* Normalize excessive blank lines

### Command Name

```
normalizeClaudeOutput
```

Displayed in command palette as:

```
Normalize Pasted Claude Output
```

### Functional Requirements

#### 1. Normalize newline

Convert CRLF to LF.

#### 2. Preserve fenced code blocks

Detect triple backtick blocks:

````
```lang
...
````

```

Content inside must remain untouched.

#### 3. Preserve ASCII table blocks

Detect lines containing any of:

```

┌ ┐ └ ┘ ─ │ ├ ┤ ┬ ┴ ┼

```

Consecutive such lines are treated as a block and must not be modified.

#### 4. Remove common indentation

For normal text lines:

- Detect minimum leading spaces shared across consecutive indented lines
- Remove that common indent
- Do not affect preserved blocks

#### 5. Normalize Markdown headings

Convert:

```

```
 ## Heading
```

```

to:

```

## Heading

````

#### 6. Remove trailing whitespace

Strip spaces and tabs at line ends.

#### 7. Normalize blank lines

- Collapse 3+ consecutive blank lines into 2
- Preserve single blank lines between sections

#### 8. Reflow broken paragraphs

For consecutive normal text lines:

If:
- Line does not end with `.`, `:`, `!`, `?`
- Next line starts with lowercase letter
- Neither line is a heading/list/table/code

Then join them with a single space.

### Implementation Constraints

- Pure TypeScript
- No external formatting libraries
- Deterministic output
- Entire document replace via `TextEditor.edit`

### Structure

Implement:

```ts
function normalizeClaudeText(input: string): string
````

and call it from the command handler.

### Non-Goals

* Do not attempt full Markdown formatting
* Do not convert ASCII tables to Markdown tables
* Do not auto-wrap to specific column width

# 6. 設計上の重要ポイント

* 「フォーマッタ」ではなく「正規化エンジン」
* ASTは不要
* 状態機械で十分
* 1パス処理可能
